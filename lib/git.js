"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _spawn = require("./promise/spawn");

var _spawn2 = _interopRequireDefault(_spawn);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = class {
    constructor(workingdir, LOG) {
        this.cwd = workingdir;
        this.LOG = LOG;
    }

    run(subcmd = []) {
        let msg = `git ${subcmd.join(" ")}`;
        this.LOG(`BEGIN ${msg}`);
        return (0, _spawn2.default)("git", subcmd, { cwd: this.cwd }).then(result => {
            this.LOG(`END   ${msg}`);
            return result;
        });
    }

    setup(name, email) {
        return this.config("user.name", name).then(() => this.config("user.email", email));
    }

    config(key, value) {
        return this.run(["config", key, value]);
    }

    fetch(remote) {
        return this.run(["fetch", "--prune", remote]);
    }

    branchList() {
        return this.run(["branch", "-a"]).then(out => out.stdout.split(/[\r]?\n/));
    }

    currentBranch() {
        return this.run(["rev-parse", "--abbrev-ref", "HEAD"]).then(out => out.stdout.trim());
    }

    checkout(branch) {
        return this.run(["checkout", branch]);
    }

    checkoutWith(newBranch) {
        return this.run(["checkout", "-b", newBranch]);
    }

    add(file) {
        return this.run(["add", file]);
    }

    commit(message) {
        return this.run(["commit", "-m", message]);
    }

    push(remote, branch) {
        return this.run(["push", remote, branch]);
    }

    remoteurl(remote) {
        return this.run(["remote", "get-url", "--push", remote]).then(out => {
            return out.stdout.trim();
        });
    }

    deleteBranch(branch) {
        return this.run(["branch", "-D", branch]);
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9naXQuanMiXSwibmFtZXMiOlsiY29uc3RydWN0b3IiLCJ3b3JraW5nZGlyIiwiTE9HIiwiY3dkIiwicnVuIiwic3ViY21kIiwibXNnIiwiam9pbiIsInRoZW4iLCJyZXN1bHQiLCJzZXR1cCIsIm5hbWUiLCJlbWFpbCIsImNvbmZpZyIsImtleSIsInZhbHVlIiwiZmV0Y2giLCJyZW1vdGUiLCJicmFuY2hMaXN0Iiwib3V0Iiwic3Rkb3V0Iiwic3BsaXQiLCJjdXJyZW50QnJhbmNoIiwidHJpbSIsImNoZWNrb3V0IiwiYnJhbmNoIiwiY2hlY2tvdXRXaXRoIiwibmV3QnJhbmNoIiwiYWRkIiwiZmlsZSIsImNvbW1pdCIsIm1lc3NhZ2UiLCJwdXNoIiwicmVtb3RldXJsIiwiZGVsZXRlQnJhbmNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7Ozs7O2tCQUVlLE1BQU07QUFDakJBLGdCQUFZQyxVQUFaLEVBQXdCQyxHQUF4QixFQUE2QjtBQUN6QixhQUFLQyxHQUFMLEdBQVdGLFVBQVg7QUFDQSxhQUFLQyxHQUFMLEdBQVdBLEdBQVg7QUFDSDs7QUFFREUsUUFBSUMsU0FBUyxFQUFiLEVBQWlCO0FBQ2IsWUFBSUMsTUFBTyxPQUFNRCxPQUFPRSxJQUFQLENBQVksR0FBWixDQUFpQixFQUFsQztBQUNBLGFBQUtMLEdBQUwsQ0FBVSxTQUFRSSxHQUFJLEVBQXRCO0FBQ0EsZUFBTyxxQkFBTSxLQUFOLEVBQWFELE1BQWIsRUFBcUIsRUFBRUYsS0FBSyxLQUFLQSxHQUFaLEVBQXJCLEVBQXdDSyxJQUF4QyxDQUE2Q0MsVUFBVTtBQUMxRCxpQkFBS1AsR0FBTCxDQUFVLFNBQVFJLEdBQUksRUFBdEI7QUFDQSxtQkFBT0csTUFBUDtBQUNILFNBSE0sQ0FBUDtBQUlIOztBQUVEQyxVQUFNQyxJQUFOLEVBQVlDLEtBQVosRUFBbUI7QUFDZixlQUFPLEtBQUtDLE1BQUwsQ0FBWSxXQUFaLEVBQXlCRixJQUF6QixFQUNGSCxJQURFLENBQ0csTUFBTSxLQUFLSyxNQUFMLENBQVksWUFBWixFQUEwQkQsS0FBMUIsQ0FEVCxDQUFQO0FBRUg7O0FBRURDLFdBQU9DLEdBQVAsRUFBWUMsS0FBWixFQUFtQjtBQUNmLGVBQU8sS0FBS1gsR0FBTCxDQUFTLENBQUMsUUFBRCxFQUFXVSxHQUFYLEVBQWdCQyxLQUFoQixDQUFULENBQVA7QUFDSDs7QUFFREMsVUFBTUMsTUFBTixFQUFjO0FBQ1YsZUFBTyxLQUFLYixHQUFMLENBQVMsQ0FBQyxPQUFELEVBQVUsU0FBVixFQUFxQmEsTUFBckIsQ0FBVCxDQUFQO0FBQ0g7O0FBRURDLGlCQUFhO0FBQ1QsZUFBTyxLQUFLZCxHQUFMLENBQVMsQ0FBQyxRQUFELEVBQVcsSUFBWCxDQUFULEVBQ0ZJLElBREUsQ0FDR1csT0FBT0EsSUFBSUMsTUFBSixDQUFXQyxLQUFYLENBQWlCLFNBQWpCLENBRFYsQ0FBUDtBQUVIOztBQUVEQyxvQkFBZ0I7QUFDWixlQUFPLEtBQUtsQixHQUFMLENBQVMsQ0FBQyxXQUFELEVBQWMsY0FBZCxFQUE4QixNQUE5QixDQUFULEVBQ0ZJLElBREUsQ0FDR1csT0FBT0EsSUFBSUMsTUFBSixDQUFXRyxJQUFYLEVBRFYsQ0FBUDtBQUVIOztBQUVEQyxhQUFTQyxNQUFULEVBQWlCO0FBQ2IsZUFBTyxLQUFLckIsR0FBTCxDQUFTLENBQUMsVUFBRCxFQUFhcUIsTUFBYixDQUFULENBQVA7QUFDSDs7QUFFREMsaUJBQWFDLFNBQWIsRUFBd0I7QUFDcEIsZUFBTyxLQUFLdkIsR0FBTCxDQUFTLENBQUMsVUFBRCxFQUFhLElBQWIsRUFBbUJ1QixTQUFuQixDQUFULENBQVA7QUFDSDs7QUFFREMsUUFBSUMsSUFBSixFQUFVO0FBQ04sZUFBTyxLQUFLekIsR0FBTCxDQUFTLENBQUMsS0FBRCxFQUFReUIsSUFBUixDQUFULENBQVA7QUFDSDs7QUFFREMsV0FBT0MsT0FBUCxFQUFnQjtBQUNaLGVBQU8sS0FBSzNCLEdBQUwsQ0FBUyxDQUFDLFFBQUQsRUFBVyxJQUFYLEVBQWlCMkIsT0FBakIsQ0FBVCxDQUFQO0FBQ0g7O0FBRURDLFNBQUtmLE1BQUwsRUFBYVEsTUFBYixFQUFxQjtBQUNqQixlQUFPLEtBQUtyQixHQUFMLENBQVMsQ0FBQyxNQUFELEVBQVNhLE1BQVQsRUFBaUJRLE1BQWpCLENBQVQsQ0FBUDtBQUNIOztBQUVEUSxjQUFVaEIsTUFBVixFQUFrQjtBQUNkLGVBQU8sS0FBS2IsR0FBTCxDQUFTLENBQUMsUUFBRCxFQUFXLFNBQVgsRUFBc0IsUUFBdEIsRUFBZ0NhLE1BQWhDLENBQVQsRUFBa0RULElBQWxELENBQXVEVyxPQUFPO0FBQ2pFLG1CQUFPQSxJQUFJQyxNQUFKLENBQVdHLElBQVgsRUFBUDtBQUNILFNBRk0sQ0FBUDtBQUdIOztBQUVEVyxpQkFBYVQsTUFBYixFQUFxQjtBQUNqQixlQUFPLEtBQUtyQixHQUFMLENBQVMsQ0FBQyxRQUFELEVBQVcsSUFBWCxFQUFpQnFCLE1BQWpCLENBQVQsQ0FBUDtBQUNIO0FBbEVnQixDIiwiZmlsZSI6ImdpdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzcGF3biBmcm9tIFwiLi9wcm9taXNlL3NwYXduXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcih3b3JraW5nZGlyLCBMT0cpIHtcbiAgICAgICAgdGhpcy5jd2QgPSB3b3JraW5nZGlyO1xuICAgICAgICB0aGlzLkxPRyA9IExPRztcbiAgICB9XG5cbiAgICBydW4oc3ViY21kID0gW10pIHtcbiAgICAgICAgbGV0IG1zZyA9IGBnaXQgJHtzdWJjbWQuam9pbihcIiBcIil9YDtcbiAgICAgICAgdGhpcy5MT0coYEJFR0lOICR7bXNnfWApO1xuICAgICAgICByZXR1cm4gc3Bhd24oXCJnaXRcIiwgc3ViY21kLCB7IGN3ZDogdGhpcy5jd2QgfSkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5MT0coYEVORCAgICR7bXNnfWApO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2V0dXAobmFtZSwgZW1haWwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnKFwidXNlci5uYW1lXCIsIG5hbWUpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLmNvbmZpZyhcInVzZXIuZW1haWxcIiwgZW1haWwpKTtcbiAgICB9XG5cbiAgICBjb25maWcoa2V5LCB2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW4oW1wiY29uZmlnXCIsIGtleSwgdmFsdWVdKTtcbiAgICB9XG5cbiAgICBmZXRjaChyZW1vdGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuKFtcImZldGNoXCIsIFwiLS1wcnVuZVwiLCByZW1vdGVdKTtcbiAgICB9XG5cbiAgICBicmFuY2hMaXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW4oW1wiYnJhbmNoXCIsIFwiLWFcIl0pXG4gICAgICAgICAgICAudGhlbihvdXQgPT4gb3V0LnN0ZG91dC5zcGxpdCgvW1xccl0/XFxuLykpO1xuICAgIH1cblxuICAgIGN1cnJlbnRCcmFuY2goKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ1bihbXCJyZXYtcGFyc2VcIiwgXCItLWFiYnJldi1yZWZcIiwgXCJIRUFEXCJdKVxuICAgICAgICAgICAgLnRoZW4ob3V0ID0+IG91dC5zdGRvdXQudHJpbSgpKTtcbiAgICB9XG5cbiAgICBjaGVja291dChicmFuY2gpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuKFtcImNoZWNrb3V0XCIsIGJyYW5jaF0pO1xuICAgIH1cblxuICAgIGNoZWNrb3V0V2l0aChuZXdCcmFuY2gpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuKFtcImNoZWNrb3V0XCIsIFwiLWJcIiwgbmV3QnJhbmNoXSk7XG4gICAgfVxuXG4gICAgYWRkKGZpbGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuKFtcImFkZFwiLCBmaWxlXSk7XG4gICAgfVxuXG4gICAgY29tbWl0KG1lc3NhZ2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuKFtcImNvbW1pdFwiLCBcIi1tXCIsIG1lc3NhZ2VdKTtcbiAgICB9XG5cbiAgICBwdXNoKHJlbW90ZSwgYnJhbmNoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ1bihbXCJwdXNoXCIsIHJlbW90ZSwgYnJhbmNoXSk7XG4gICAgfVxuXG4gICAgcmVtb3RldXJsKHJlbW90ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW4oW1wicmVtb3RlXCIsIFwiZ2V0LXVybFwiLCBcIi0tcHVzaFwiLCByZW1vdGVdKS50aGVuKG91dCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gb3V0LnN0ZG91dC50cmltKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGRlbGV0ZUJyYW5jaChicmFuY2gpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuKFtcImJyYW5jaFwiLCBcIi1EXCIsIGJyYW5jaF0pO1xuICAgIH1cbn1cbiJdfQ==