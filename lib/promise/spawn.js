"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function (cmd, subcmd = [], options = {}) {
    return new Promise((resolve, reject) => {
        options.maxBuffer = 1024 * 1024;
        let cp = spawn(cmd, subcmd, options);
        let stdout = [],
            stderr = [];
        let error = "";
        let setup = (stream, msgs) => {
            if (stream) {
                stream.on("data", buf => msgs.push(buf));
            }
        };
        setup(cp.stdout, stdout);
        setup(cp.stderr, stderr);

        cp.on("error", err => {
            error = err;
        });
        let concat = msgs => 0 < msgs.length ? Buffer.concat(msgs).toString() : "";
        cp.on("close", code => {
            let result = {
                error: error,
                errorcode: code,
                stdout: concat(stdout),
                stderr: concat(stderr)
            };
            if (code) {
                reject(result);
            } else {
                resolve(result);
            }
        });
    });
};

var spawn = require("cross-spawn");
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wcm9taXNlL3NwYXduLmpzIl0sIm5hbWVzIjpbImNtZCIsInN1YmNtZCIsIm9wdGlvbnMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm1heEJ1ZmZlciIsImNwIiwic3Bhd24iLCJzdGRvdXQiLCJzdGRlcnIiLCJlcnJvciIsInNldHVwIiwic3RyZWFtIiwibXNncyIsIm9uIiwiYnVmIiwicHVzaCIsImVyciIsImNvbmNhdCIsImxlbmd0aCIsIkJ1ZmZlciIsInRvU3RyaW5nIiwiY29kZSIsInJlc3VsdCIsImVycm9yY29kZSIsInJlcXVpcmUiXSwibWFwcGluZ3MiOiI7Ozs7OztrQkFFZSxVQUFVQSxHQUFWLEVBQWVDLFNBQVMsRUFBeEIsRUFBNEJDLFVBQVUsRUFBdEMsRUFBMEM7QUFDckQsV0FBTyxJQUFJQyxPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDSCxnQkFBUUksU0FBUixHQUFvQixPQUFPLElBQTNCO0FBQ0EsWUFBSUMsS0FBS0MsTUFBTVIsR0FBTixFQUFXQyxNQUFYLEVBQW1CQyxPQUFuQixDQUFUO0FBQ0EsWUFBSU8sU0FBUyxFQUFiO0FBQUEsWUFBaUJDLFNBQVMsRUFBMUI7QUFDQSxZQUFJQyxRQUFRLEVBQVo7QUFDQSxZQUFJQyxRQUFRLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxLQUFrQjtBQUMxQixnQkFBSUQsTUFBSixFQUFZO0FBQ1JBLHVCQUFPRSxFQUFQLENBQVUsTUFBVixFQUFrQkMsT0FBT0YsS0FBS0csSUFBTCxDQUFVRCxHQUFWLENBQXpCO0FBQ0g7QUFDSixTQUpEO0FBS0FKLGNBQU1MLEdBQUdFLE1BQVQsRUFBaUJBLE1BQWpCO0FBQ0FHLGNBQU1MLEdBQUdHLE1BQVQsRUFBaUJBLE1BQWpCOztBQUVBSCxXQUFHUSxFQUFILENBQU0sT0FBTixFQUFlRyxPQUFPO0FBQ2xCUCxvQkFBUU8sR0FBUjtBQUNILFNBRkQ7QUFHQSxZQUFJQyxTQUFVTCxJQUFELElBQVUsSUFBSUEsS0FBS00sTUFBVCxHQUFrQkMsT0FBT0YsTUFBUCxDQUFjTCxJQUFkLEVBQW9CUSxRQUFwQixFQUFsQixHQUFtRCxFQUExRTtBQUNBZixXQUFHUSxFQUFILENBQU0sT0FBTixFQUFlUSxRQUFRO0FBQ25CLGdCQUFJQyxTQUFTO0FBQ1RiLHVCQUFPQSxLQURFO0FBRVRjLDJCQUFXRixJQUZGO0FBR1RkLHdCQUFRVSxPQUFPVixNQUFQLENBSEM7QUFJVEMsd0JBQVFTLE9BQU9ULE1BQVA7QUFKQyxhQUFiO0FBTUEsZ0JBQUlhLElBQUosRUFBVTtBQUNObEIsdUJBQU9tQixNQUFQO0FBQ0gsYUFGRCxNQUVPO0FBQ0hwQix3QkFBUW9CLE1BQVI7QUFDSDtBQUNKLFNBWkQ7QUFhSCxLQTlCTSxDQUFQO0FBK0JILEM7O0FBbENELElBQUloQixRQUFRa0IsUUFBUSxhQUFSLENBQVoiLCJmaWxlIjoic3Bhd24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgc3Bhd24gPSByZXF1aXJlKFwiY3Jvc3Mtc3Bhd25cIik7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIChjbWQsIHN1YmNtZCA9IFtdLCBvcHRpb25zID0ge30pIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBvcHRpb25zLm1heEJ1ZmZlciA9IDEwMjQgKiAxMDI0O1xuICAgICAgICBsZXQgY3AgPSBzcGF3bihjbWQsIHN1YmNtZCwgb3B0aW9ucyk7XG4gICAgICAgIGxldCBzdGRvdXQgPSBbXSwgc3RkZXJyID0gW107XG4gICAgICAgIGxldCBlcnJvciA9IFwiXCI7XG4gICAgICAgIGxldCBzZXR1cCA9IChzdHJlYW0sIG1zZ3MpID0+IHtcbiAgICAgICAgICAgIGlmIChzdHJlYW0pIHtcbiAgICAgICAgICAgICAgICBzdHJlYW0ub24oXCJkYXRhXCIsIGJ1ZiA9PiBtc2dzLnB1c2goYnVmKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHNldHVwKGNwLnN0ZG91dCwgc3Rkb3V0KTtcbiAgICAgICAgc2V0dXAoY3Auc3RkZXJyLCBzdGRlcnIpO1xuXG4gICAgICAgIGNwLm9uKFwiZXJyb3JcIiwgZXJyID0+IHtcbiAgICAgICAgICAgIGVycm9yID0gZXJyO1xuICAgICAgICB9KTtcbiAgICAgICAgbGV0IGNvbmNhdCA9IChtc2dzKSA9PiAwIDwgbXNncy5sZW5ndGggPyBCdWZmZXIuY29uY2F0KG1zZ3MpLnRvU3RyaW5nKCkgOiBcIlwiO1xuICAgICAgICBjcC5vbihcImNsb3NlXCIsIGNvZGUgPT4ge1xuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3IsXG4gICAgICAgICAgICAgICAgZXJyb3Jjb2RlOiBjb2RlLFxuICAgICAgICAgICAgICAgIHN0ZG91dDogY29uY2F0KHN0ZG91dCksXG4gICAgICAgICAgICAgICAgc3RkZXJyOiBjb25jYXQoc3RkZXJyKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChjb2RlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG4iXX0=